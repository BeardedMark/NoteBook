# Словарь терминов проекта

## Общие термины

### Движок (Engine)
Основной класс, координирующий все системы игры. Управляет инициализацией, обновлением и рендерингом.

### Карта (Map)
Игровой мир, состоящий из объектов, границ и начальной позиции игрока. Загружается из `data/map.json`.

### Объект (Object)
Элемент игрового мира, размещенный на карте. Имеет координаты, тип, изображение и опционально коллайдер.

### Игрок (Player)
Управляемый персонаж в игре. Имеет позицию (x, y), скорость и радиус коллизии.

---

## Системы координат

### Мировые координаты (World Coordinates)
Координаты объектов в игровом мире. Используются для логики игры, коллизий и хранения данных.

**Формат**: `{x: number, y: number}`
- **X** - горизонтальная координата (влево/вправо)
- **Y** - вертикальная координата (вверх/вниз, используется для определения слоя/глубины)

### Экранные координаты (Screen Coordinates)
Координаты на экране пользователя. Вычисляются из мировых координат через алгоритм перспективы.

**Формат**: `{x: number, y: number}`
- **X** - позиция по горизонтали на экране (в пикселях)
- **Y** - позиция по вертикали на экране (в пикселях)

### Преобразование координат (Coordinate Transformation)
Процесс преобразования мировых координат в экранные через единый алгоритм перспективы.

**Формула X**:
dx = worldX - player.x
scaledDx = dx * scale
screenX = centerX + scaledDx


**Формула Y**:
worldRatio = (worldY - horizonWorldY) / totalWorldRange
perspectiveRatio = worldRatio^layerSpacingCoefficient
screenY = topScreenY + perspectiveRatio * (bottomScreenY - topScreenY)

---

## Система рендеринга

### Рендеринг (Rendering)
Процесс отрисовки игрового мира на экране. Включает преобразование данных в визуальное представление.

### Рендерер (Renderer)
Класс, отвечающий за отрисовку определенной части сцены.

**Типы рендереров**:
- **MapRenderer** - 2D рендерер карты (вид сверху)
- **SceneRenderer** - 3D рендерер сцены (перспектива)

### Canvas
HTML5 элемент для растровой графики. Используется для отрисовки сеток, коллизий и отладочной информации.

### SVG
Масштабируемая векторная графика. Используется для интерактивных объектов сцены.

### ViewBox
Область видимости SVG или Canvas. Определяет, какая часть мира отображается.

---

## Перспектива и глубина

### Frustum (Область видимости)
Трапециевидная область, определяющая какие объекты видны на экране.

**Параметры**:
- **height** - Общая высота области (в мировых координатах)
- **widthTop** - Ширина верхней границы (дальше от игрока)
- **widthBottom** - Ширина нижней границы (ближе к игроку)
- **playerPosition** - Позиция игрока в frustum (0-100%, где 0% = низ, 100% = верх)

### Перспектива (Perspective)
Эмуляция 3D через математические преобразования координат.

**Эффекты перспективы**:
- **Масштабирование слоев** - Объекты дальше меньше, ближе больше
- **Неравномерное расстояние** - Дальние слои ближе друг к другу
- **Frustum culling** - Отсечение объектов вне области видимости

### Слой (Layer)
Группа объектов с одинаковой Y-координатой в мире. Каждый слой рендерится на одной Y-координате экрана.

**Характеристики слоя**:
- Имеет свой масштаб (на основе расстояния от игрока)
- Рендерится на одной Y-координате экрана
- Сортируется для правильного порядка отрисовки

### Параллакс (Parallax)
Эффект глубины, создаваемый разной скоростью движения слоев при перемещении камеры.

**В проекте**: Слои с разными Y-координатами имеют разный масштаб и позицию, создавая эффект глубины.

### Горизонт (Horizon)
Виртуальная линия, разделяющая небо и землю. Определяется параметром `groundPercentage`.

**Параметры**:
- **groundPercentage** - Процент экрана под землей (0% = весь экран небо, 100% = весь экран земля)
- **horizonBlur** - Размытие границы горизонта (0-100%)

---

## Масштабирование

### Масштаб слоя (Layer Scale)
Коэффициент масштабирования для объектов на определенной Y-координате.

**Вычисление**:
scale = playerFrustumWidth / frustumWidthAtY
finalScale = 1.0 + (scale - 1.0) * layerScaleCoefficient

### Масштаб карты (Map Scale)
Масштаб отображения карты в процентах (100-1000%, где 100% = 1:1).

### Коэффициент масштабирования (Layer Scale Coefficient)
Параметр, усиливающий или ослабляющий эффект масштабирования слоев (0.0-3.0).

### Коэффициент сжатия слоев (Layer Spacing Coefficient)
Параметр, определяющий степень сжатия дальних слоев (1.0-5.0).
- **1.0** - линейное маппирование
- **>1.0** - дальние слои сжаты (ближе друг к другу)
- **<1.0** - дальние слои растянуты (дальше друг от друга)

---

## Эффекты визуализации

### Размытие (Blur)
Эффект размытия для создания атмосферной перспективы.

**Типы**:
- **maxBlur** - Интенсивность размытия для нижних слоев (ближе к экрану)
- **maxBlurTop** - Интенсивность размытия для верхних слоев (дальше от экрана)
- **blurLayersPercentage** - Процент слоев, которые будут размыты

### Прозрачность (Opacity)
Степень непрозрачности слоя (0.0-1.0, где 1.0 = полностью непрозрачный).

**Применение**:
- Дальние слои могут иметь меньшую прозрачность для эффекта тумана
- Ближние слои могут иметь размытие для эффекта глубины

### Виньетка (Vignette)
Эффект затемнения краев экрана для фокусировки внимания на центре.

**Параметры**:
- **vignetteOpacity** - Интенсивность виньетки (0-100%)
- **vignetteSize** - Размер виньетки (в пикселях)
- **vignetteSpread** - Распространение виньетки (в пикселях)

---

## Физика и коллизии

### Коллайдер (Collider)
Невидимая область, определяющая границы объекта для проверки столкновений.

**Типы коллайдеров**:
- **circle** - Круглый коллайдер (параметр: `width` = диаметр)
- **rectangle** - Прямоугольный коллайдер (параметры: `width`, `height`)

### Коллизия (Collision)
Столкновение объектов. Проверяется через `CollisionDetector`.

### Скольжение (Sliding)
Механика движения вдоль поверхности коллайдера при столкновении.

**Применение**: Позволяет персонажу скользить вдоль краев объектов вместо полной остановки.

### Радиус коллизии (Collision Radius)
Радиус круглого коллайдера персонажа. Используется для проверки столкновений.

### Радиус взаимодействия (Interaction Radius)
Расстояние, на котором игрок может взаимодействовать с объектами (подбирать, размещать).

---

## Инвентарь и взаимодействие

### Инвентарь (Inventory)
Система хранения предметов игрока. Состоит из 6 слотов (0-5).

### Слот (Slot)
Ячейка инвентаря для хранения одного предмета.

### Подбор предмета (Item Pickup)
Действие взятия предмета с карты в инвентарь (клавиша E).

### Размещение предмета (Item Placement)
Действие размещения предмета из инвентаря на карту (клик мыши).

### Превью размещения (Placement Preview)
Визуальное отображение предмета перед размещением на карте.

---

## Камера

### Камера (Camera)
Виртуальная камера, определяющая область видимости карты.

**Параметры**:
- **x, y** - Позиция камеры в мире
- **scale** - Масштаб камеры (5-100%)

### Высота камеры (Camera Height)
Виртуальная высота камеры над землей (0-100%, где 0% = низ экрана).

### Центрирование (Centering)
Процесс размещения игрока в центре видимой области.

---

## Сетки и отладка

### Сетка плоскости (Plane Grid)
Сетка координат, отображаемая на Canvas для визуализации структуры мира.

**Параметры**:
- **planeStep** - Шаг сетки (в мировых координатах)

### Сетка области действия (Interaction Area Grid)
Сетка в радиусе взаимодействия для визуализации доступной области.

**Параметры**:
- **interactionAreaStep** - Шаг сетки области действия

### Сетка земли (Ground Grid)
Сетка на слоях земли для визуализации глубины.

**Параметры**:
- **groundGridStep** - Шаг сетки на земле
- **groundGridOpacity** - Прозрачность точек сетки

---

## Земля и слои

### Слои земли (Ground Layers)
Параллакс-слои земли, создающие эффект глубины.

**Параметры**:
- **showLayers** - Отображать слои земли
- **layerStep** - Шаг слоев земли (каждый N-й Y-слой)
- **opacity** - Прозрачность заливки земли

### Прореживание слоев (Layer Thinning)
Процесс уменьшения количества отображаемых слоев для оптимизации.

**Параметры**:
- **thinningStartPercent** - Откуда начинать прореживание (0% = от ближайших)
- **thinningIntensity** - Интенсивность прореживания (0% = все слои, 100% = почти все)

---

## Границы и отступы

### Границы карты (Map Bounds)
Прямоугольная область, ограничивающая игровой мир.

**Формат**: `{minX, minY, maxX, maxY}`

### Отступы рендера (Render Margins)
Отступы от краев экрана для области рендеринга.

**Параметры**:
- **top** - Верхний отступ (в процентах)
- **bottom** - Нижний отступ (в процентах)
- **side** - Боковой отступ (в процентах)

### Границы рендера (Render Bounds)
Вычисленная область экрана, используемая для рендеринга.

**Содержит**:
- **centerX** - Центр области по X
- **topScreenY** - Верхняя граница по Y
- **bottomScreenY** - Нижняя граница по Y

---

## Объекты и типы

### Тип объекта (Object Type)
Категория объекта, определяющая его цвет на карте и поведение.

**Типы**:
- **nature** - Природа (зеленый)
- **decoration** - Декорация (оранжевый)
- **building** - Здание (синий)
- **furniture** - Мебель (фиолетовый)

### Код объекта (Object Code)
Уникальный идентификатор типа объекта в библиотеке `objects.json`.

### Библиотека объектов (Objects Library)
Коллекция шаблонов объектов (`data/objects.json`), используемых на карте.

### Шаблон объекта (Object Template)
Описание типа объекта в библиотеке, содержащее свойства (name, image, type, collider).

---

## Игровой цикл

### Игровой цикл (Game Loop)
Основной цикл игры, выполняющий обновление логики и рендеринг каждый кадр.

**Этапы**:
1. Обновление ввода
2. Обновление логики (движение, коллизии, инвентарь)
3. Рендеринг

### Delta Time
Время, прошедшее с последнего кадра (в секундах). Используется для независимой от FPS логики.

### FPS (Frames Per Second)
Количество кадров в секунду. Целевое значение: 60 FPS.

---

## Кеширование и оптимизация

### Кеш (Cache)
Временное хранилище вычисленных значений для оптимизации производительности.

**Типы кеша**:
- **scaleCache** - Кеш масштабов слоев
- **screenYCache** - Кеш экранных Y-координат
- **imageSizeCache** - Кеш размеров изображений

### Debouncing
Техника задержки выполнения функции для предотвращения избыточных вызовов.

### Frustum Culling
Оптимизация, отсекающая объекты вне области видимости (frustum).

---

## Визуализация и отладка

### Визуализация (Visualization)
Отображение отладочной информации на карте и сцене.

**Элементы визуализации**:
- Радиус взаимодействия
- Границы frustum
- Коллайдеры объектов
- Сетки координат

### Отладочные элементы (Debug Elements)
Визуальные элементы для отладки и настройки игры.

---

## Цвета и палитра

### Палитра (Palette)
Набор цветов для фона сцены.

**Цвета**:
- **sky** - Цвет неба
- **ground** - Цвет земли

### Цвета объектов (Object Colors)
Цвета для разных типов объектов на карте.

---

## Спрайты и изображения

### Спрайт (Sprite)
Изображение объекта, отображаемое на сцене.

### Изображение объекта (Object Image)
Путь к файлу изображения объекта (PNG с прозрачностью).

### Смещение спрайта (Sprite Offset)
Смещение изображения по Y-координате для правильного позиционирования.

---

## Алгоритмы и вычисления

### Единый алгоритм координат (Unified Coordinate Algorithm)
Единый алгоритм преобразования координат, используемый для всех элементов сцены (Canvas и SVG).

### Маппинг (Mapping)
Процесс преобразования значений из одного диапазона в другой.

**Примеры**:
- `mapWorldYToScreenY` - Маппинг Y-координаты мира в экранную
- `mapScreenYToWorldY` - Обратный маппинг Y-координаты

### Интерполяция (Interpolation)
Вычисление промежуточных значений между двумя точками.

**В проекте**: Линейная интерполяция ширины frustum между верхом и низом.

---

## Состояние и флаги

### Состояние (State)
Текущее состояние системы или компонента.

**Примеры**:
- `isRunning` - Движок запущен
- `collisionsEnabled` - Коллизии включены
- `enabled` - Компонент активен

### Флаг (Flag)
Булево значение, определяющее состояние или поведение.

---

## События и ввод

### Ввод (Input)
Данные от устройств ввода (клавиатура, мышь).

### Обработчик событий (Event Handler)
Функция, вызываемая при наступлении события.

### Клавиша (Key)
Физическая клавиша на клавиатуре. Используются физические коды (`KeyW`, `ArrowUp`) для независимости от раскладки.

---

## Примечания

- Все координаты в мире округляются до ближайшего числа, кратного 10
- Y-координата определяет слой объекта для перспективного рендеринга
- Меньшая Y-координата = дальше от экрана = рисуется первой
- Большая Y-координата = ближе к экрану = рисуется последней
- Персонаж всегда в центре экрана по X и на линии горизонта по Y